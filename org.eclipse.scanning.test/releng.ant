<project name="plugin-org.eclipse.scanning.test" basedir=".">

	<dirname property="plugin.basedir" file="${ant.file}" />
	<pathconvert property="workspace.loc" setonempty="false">
		<regexpmapper from="(.*)_git/.+" to="\1"/>
		<path><pathelement location="${plugin.basedir}" /></path>
	</pathconvert>
	<fail message="ERROR: Could not determine workspace.loc" unless="workspace.loc" />
	<property name="workspace.git.loc" value="${workspace.loc}_git" />
	<import file="${workspace.git.loc}/gda-core.git/diamond.releng.tools.gda/ant-headless/common.ant" />

	<!-- ====================================================================
		   JUnit tests
		 ==================================================================== -->

	<import file="${workspace.git.loc}/gda-core.git/diamond.releng.tools.gda/ant-headless/test-common.ant" />
	<target name="junit-tests" depends="set-test-base-GDA">
		<junit-call description="${ant.project.name} Java JUnit tests" timeout="1800000"> <!-- 30 mins timeout -->
			<jvmarg value="-Dgda.install.workspace.loc=${workspace.loc}" />
			<jvmarg value="-Dgda.install.git.loc=${workspace.git.loc}" />
			<sysproperty key="basedir" value="${plugin.basedir}" />
			<formatter type="xml" />
			<classpath>
				<pathelement location="${junitjar.loc}" />
				<pathelement location="${plugin.basedir}/bin" />
				<pathelement location="${workspace.git.loc}/gda-core.git/diamond.releng.tools.gda/logging" />  <!-- to pick up logback-test.xml -->
				<pathelement location="${plugin.host.basedir}/bin" />
				<pathelement location="${workspace.git.loc}/dawn-hdf.git/hdf.hdf5lib/bin" />
				<pathelement location="${workspace.git.loc}/dawnsci.git/org.eclipse.dawnsci.analysis.api/bin" />
				<pathelement location="${workspace.git.loc}/dawnsci.git/org.eclipse.dawnsci.analysis.dataset/bin" />
				<pathelement location="${workspace.git.loc}/dawnsci.git/org.eclipse.dawnsci.analysis.tree/bin" />
				<pathelement location="${workspace.git.loc}/dawnsci.git/org.eclipse.dawnsci.hdf5/bin" />
				<pathelement location="${workspace.git.loc}/dawnsci.git/org.eclipse.dawnsci.nexus/bin" />
				<pathelement location="${workspace.git.loc}/dawnsci.git/org.eclipse.dawnsci.json/bin" />
				<pathelement location="${workspace.git.loc}/dawnsci.git/org.eclipse.dawnsci.remotedataset.test/bin" />
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.api/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.command/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.connector.activemq/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.connector.epics/target/classes"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.connector.epics/jars/*"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.device/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.event/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.example/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.example.xcen/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.malcolm.core/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.points/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.sequencer/bin"/>
				<pathelement location="${workspace.git.loc}/scanning.git/org.eclipse.scanning.server/bin"/>
				<pathelement location="${workspace.git.loc}/diamond-jython.git/uk.ac.diamond.jython/jython2.7/jython.jar"/>
				<path refid="tp.slf4j.path" />  <!-- ensure that required org.slf4j.LoggerFactory appears first in classpath -->
				<path refid="tp.jcl-over-slf4j.path" />  <!-- ensure that matching imp appears first in classpath -->
				<path refid="tp.hamcrest.path" />  <!-- ensure that latest version appears first in classpath -->
				<path refid="tp.path" />  <!-- target platform -->
			</classpath>
			<batchtest todir="@{report.dir}">
				<fileset dir="${plugin.basedir}/src">
					<include name="org/eclipse/scanning/sequencer/*Test.java" />

					<include name="org/eclipse/scanning/test/annot/*Test.java" />

					<include name="org/eclipse/scanning/test/command/*Test.java" />
					<exclude name="org/eclipse/scanning/test/command/Abstract*Test.java" />
					<exclude name="org/eclipse/scanning/test/command/ScanRequestTest.java" />

					<include name="org/eclipse/scanning/test/epics/*Test.java" />

					<include name="org/eclipse/scanning/test/event/SerializationTest.java" />
					<include name="org/eclipse/scanning/test/event/ScanEventTest.java" />
					<include name="org/eclipse/scanning/test/event/ConsumerTest.java" />
					<include name="org/eclipse/scanning/test/event/SubmitterTest.java" />
					<include name="org/eclipse/scanning/test/event/PauseTest.java" />
					<include name="org/eclipse/scanning/test/event/MappingScanTest.java" />
					<include name="org/eclipse/scanning/test/event/AnyBeanEventTest.java" />
					<include name="org/eclipse/scanning/test/event/DeviceRequestTest.java" />
					<include name="org/eclipse/scanning/test/event/AcquireRequestTest.java" />
					<include name="org/eclipse/scanning/test/event/QueueManagementTest.java" />
					<include name="org/eclipse/scanning/test/event/SimpleConsumerTest.java" />
					<include name="org/eclipse/scanning/test/event/ConsumerControlTest.java" />
					<include name="org/eclipse/scanning/test/event/ConsumerProxyControlTest.java" />
					<include name="org/eclipse/scanning/test/event/ProcessManagementTest.java" />

					<include name="org/eclipse/scanning/test/fakespring/*Test.java" />

					<include name="org/eclipse/scanning/test/filter/*Test.java" />

					<include name="org/eclipse/scanning/test/malcolm/real/*Test.java" />
					<exclude name="org/eclipse/scanning/test/malcolm/real/Abstract*Test.java" />

					<include name="org/eclipse/scanning/test/messaging/*Test.java" />

					<include name="org/eclipse/scanning/test/points/*Test.java" />
					<exclude name="org/eclipse/scanning/test/points/Abstract*Test.java" />
					<exclude name="org/eclipse/scanning/test/points/LissajousTest.java" />

					<include name="org/eclipse/scanning/test/remote/*Test.java" />
					<exclude name="org/eclipse/scanning/test/remote/GetDeviceInformationTest.java" />

					<include name="org/eclipse/scanning/test/scan/*Test.java" />
					<exclude name="org/eclipse/scanning/test/scan/Abstract*Test.java" />

					<include name="org/eclipse/scanning/test/scan/nexus/*Test.java" />
					<exclude name="org/eclipse/scanning/test/scan/nexus/Abstract*Test.java" />
					<exclude name="org/eclipse/scanning/test/scan/nexus/CompositeNexusScannableTest.java" />
					<exclude name="org/eclipse/scanning/test/scan/nexus/NexusTest.java" />
					<exclude name="org/eclipse/scanning/test/scan/nexus/PosDetectorScanTest.java" />
					<exclude name="org/eclipse/scanning/test/scan/nexus/ScanWithNoNexusFileTest.java" />

					<include name="org/eclipse/scanning/test/scan/preprocess/*Test.java" />

					<include name="org/eclipse/scanning/test/scan/servlet/*Test.java" />
					<exclude name="org/eclipse/scanning/test/scan/servlet/Abstract*Test.java" />
					<exclude name="org/eclipse/scanning/test/scan/servlet/DefaultConfigurationPreprocessorTest.java" />

					<include name="org/eclipse/scanning/test/validation/*Test.java" />
					<exclude name="org/eclipse/scanning/test/validation/Abstract*Test.java" />

					<exclude name="**/*PluginTest.java" />
				</fileset>
			</batchtest>
		</junit-call>
	</target>

</project>
